<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fractions 6Ã¨me - Version Enrichie</title>
    <link rel="stylesheet" href="../../../styles/index.css">
</head>
<body>
    <div class="main-container">
        <h1>ğŸ“š Comprendre les fractions - 6Ã¨me</h1>
        
        <!-- Section d'informations gÃ©nÃ©rales -->
        <div class="info-section">
            <div class="section">
                <h3>ğŸ¯ Objectif</h3>
                <p>Savoir lire, Ã©crire et reprÃ©senter une fraction.</p>
            </div>
            
            <div class="info-grid">
                <div class="info-card utilite-card">
                    <h4>ğŸŒ Pourquoi c'est important ?</h4>
                    <p>Les fractions sont essentielles pour cuisiner, partager des objets, calculer des remises, comprendre les pourcentages et gÃ©rer son budget.</p>
                </div>
                
                <div class="info-card funfact-card">
                    <h4>ğŸ¤¯ Fun Fact</h4>
                    <p>Dans une Ã©tude amÃ©ricaine, 3 adultes sur 5 ont avouÃ© qu'ils prÃ©fÃ©raient partager une pizza plutÃ´t que des bonbonsâ€¦ mais 2 sur 5 ne savaient pas calculer 3/8 d'une pizza ! ğŸ•ğŸ˜‚</p>
                </div>
            </div>
        </div>

        <!-- Phase 1: Test de PrÃ©-Ã©valuation -->
        <div class="collapsible-section">
            <div class="collapsible-header" id="preEvalHeader" onclick="toggleSection('preEval')">
                <span>ğŸ” Phase 1: Test de PrÃ©-Ã©valuation</span>
                <span class="collapsible-icon">ğŸ”½</span>
            </div>
            <div class="collapsible-content expanded" id="preEvalContent">
                <div class="collapsible-inner">
                    <div class="section pre-evaluation" id="preEvaluation">
                        <p>Ce test permet de voir si tu es dÃ©jÃ  Ã  l'aise avec ce sujet.</p>
                        
                        <div class="mini-test">
                            <h4>ğŸ“‹ Mini-test rapide</h4>
                            
                            <!-- Question 1 -->
                            <div class="test-question">
                                <p><strong>1.</strong> Dans la fraction 7/9, quel est le dÃ©nominateur ?</p>
                                <div class="test-options">
                                    <button class="test-option" onclick="answerPreTest(1, 'wrong', this)">7</button>
                                    <button class="test-option" onclick="answerPreTest(1, 'correct', this)">9</button>
                                    <button class="test-option" onclick="answerPreTest(1, 'wrong', this)">16</button>
                                    <button class="test-option" onclick="answerPreTest(1, 'wrong', this)">2</button>
                                </div>
                            </div>
                            
                            <!-- Question 2 -->
                            <div class="test-question">
                                <p><strong>2.</strong> Que reprÃ©sente la fraction 3/4 ?</p>
                                <div class="test-options">
                                    <button class="test-option" onclick="answerPreTest(2, 'wrong', this)">3 + 4</button>
                                    <button class="test-option" onclick="answerPreTest(2, 'correct', this)">3 parts sur 4</button>
                                    <button class="test-option" onclick="answerPreTest(2, 'wrong', this)">4 parts sur 3</button>
                                    <button class="test-option" onclick="answerPreTest(2, 'wrong', this)">3 Ã— 4</button>
                                </div>
                            </div>
                            
                            <!-- Question 3 -->
                            <div class="test-question">
                                <p><strong>3.</strong> Si je colorie 2 carrÃ©s sur 5, quelle fraction cela reprÃ©sente-t-il ?</p>
                                <div class="test-options">
                                    <button class="test-option" onclick="answerPreTest(3, 'wrong', this)">5/2</button>
                                    <button class="test-option" onclick="answerPreTest(3, 'correct', this)">2/5</button>
                                    <button class="test-option" onclick="answerPreTest(3, 'wrong', this)">3/5</button>
                                    <button class="test-option" onclick="answerPreTest(3, 'wrong', this)">2/3</button>
                                </div>
                            </div>
                            
                            <div class="pre-test-result" id="preTestResult" style="display: none;">
                                <div class="recommendation" id="recommendation"></div>
                                <button class="btn-primary" id="startLearning" onclick="startAdaptedPath()">Commencer</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 2: Cours et Ã‰tapes d'apprentissage -->
        <div class="collapsible-section">
            <div class="collapsible-header" id="coursHeader" onclick="toggleSection('cours')">
                <span>ğŸ“– Phase 2: Cours et Ã‰tapes d'apprentissage</span>
                <span class="collapsible-icon">ğŸ”½</span>
            </div>
            <div class="collapsible-content" id="coursContent">
                <div class="collapsible-inner">
                    <div class="section" id="coursSection">
                        <h3>ğŸ“– Cours</h3>
                        <p>Une fraction reprÃ©sente une partie d'un tout. Exemple : 3/4 signifie 3 parts sur 4 au total.</p>
                    </div>

                    <div class="section">
                        <h3>ğŸ”¢ Ã‰tapes d'apprentissage</h3>
                        <div class="etapes">
                            <ol>
                                <li>
                                    <strong>Identifier le numÃ©rateur et le dÃ©nominateur</strong>
                                    <div class="etape-detail">
                                        <strong>Comment :</strong> Dans une fraction a/b, le nombre du haut (a) est le numÃ©rateur (parts prises), le nombre du bas (b) est le dÃ©nominateur (total de parts). 
                                        <em>Exemple : dans 3/5, le numÃ©rateur est 3 et le dÃ©nominateur est 5.</em>
                                    </div>
                                </li>
                                <li>
                                    <strong>ReprÃ©senter une fraction sur un schÃ©ma</strong>
                                    <div class="etape-detail">
                                        <strong>Comment :</strong> Dessine une figure (cercle, rectangle, barre) et divise-la en autant de parts Ã©gales que le dÃ©nominateur, puis colorie le nombre de parts indiquÃ© par le numÃ©rateur.
                                        <em>Exemple : pour 2/3, divise en 3 parts et colorie 2 parts.</em>
                                    </div>
                                </li>
                                <li>
                                    <strong>Comparer et classer des fractions</strong>
                                    <div class="etape-detail">
                                        <strong>Comment :</strong> Si mÃªme dÃ©nominateur, compare les numÃ©rateurs. Sinon, convertis au mÃªme dÃ©nominateur ou utilise les dÃ©cimaux.
                                        <em>Exemple : 2/5 < 3/5 car 2 < 3. Pour 1/2 vs 2/3, convertis : 3/6 vs 4/6, donc 1/2 < 2/3.</em>
                                    </div>
                                </li>
                            </ol>
                        </div>
                    </div>

                    <div class="section">
                        <h3>ğŸ’¡ Exemple concret</h3>
                        <p>Si tu manges 2 parts sur 8 d'un gÃ¢teau, tu as mangÃ© 2/8, soit 1/4.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 3: Exercices progressifs -->
        <div class="collapsible-section">
            <div class="collapsible-header" id="exercicesHeader" onclick="toggleSection('exercices')">
                <span>ğŸ‹ï¸ Phase 3: Exercices progressifs</span>
                <span class="collapsible-icon">ğŸ”½</span>
            </div>
            <div class="collapsible-content" id="exercicesContent">
                <div class="collapsible-inner">
                    
                    <!-- Astuces & PiÃ¨ges -->
                    <div class="section">
                        <h3>ğŸ’¡ Astuces & PiÃ¨ges</h3>
                        <div class="astuce">
                            <strong>ğŸ¯ Astuce :</strong> Pour bien identifier une fraction, souviens-toi que le numÃ©rateur (en haut) indique combien de parts on prend, et le dÃ©nominateur (en bas) indique en combien de parts Ã©gales on divise le tout.
                        </div>
                        <div class="astuce" style="margin-top: 10px; background: linear-gradient(135deg, #fed7e2 0%, #fbb6ce 100%); border-left-color: #e53e3e;">
                            <strong>âš ï¸ PiÃ¨ge classique :</strong> Ne confonds pas 3/4 avec 4/3 ! Dans 3/4, on prend 3 parts sur 4. Dans 4/3, on prend 4 parts sur 3 (plus que le tout !).
                        </div>
                    </div>
                    
                    <div class="section">                
                        <div class="exercices">
                            <div class="exercice debutant">
                                <strong>ğŸŸ¢ DÃ©butant</strong><br>
                                <p>Colorie 1/2 d'un rectangle.</p>
                                <div class="exercice-interactif">
                                    <div class="rectangle-grid" id="rect-exercise">
                                        <div class="rect-part" onclick="togglePart(this)"></div>
                                        <div class="rect-part" onclick="togglePart(this)"></div>
                                        <div class="rect-part" onclick="togglePart(this)"></div>
                                        <div class="rect-part" onclick="togglePart(this)"></div>
                                    </div>
                                    <button onclick="checkRectangle()" class="check-btn">VÃ©rifier</button>
                                    <div id="rect-feedback" class="exercise-feedback"></div>
                                </div>
                            </div>
                            <div class="exercice intermediaire">
                                <strong>ğŸŸ¡ IntermÃ©diaire</strong><br>
                                <p>RepÃ¨re 3/4 sur une droite graduÃ©e.</p>
                                <div class="exercice-interactif">
                                    <div class="number-line">
                                        <div class="line"></div>
                                        <div class="markers">
                                            <span class="marker" data-value="0">0</span>
                                            <span class="marker clickable" data-value="0.25" onclick="selectMarker(this, '1/4')">|</span>
                                            <span class="marker clickable" data-value="0.5" onclick="selectMarker(this, '1/2')">|</span>
                                            <span class="marker clickable" data-value="0.75" onclick="selectMarker(this, '3/4')">|</span>
                                            <span class="marker" data-value="1">1</span>
                                        </div>
                                    </div>
                                    <p style="margin: 10px 0;">Clique sur la position de 3/4 :</p>
                                    <div id="line-feedback" class="exercise-feedback"></div>
                                </div>
                            </div>
                            <div class="exercice avance">
                                <strong>ğŸ”´ AvancÃ©</strong><br>
                                <p>Calcule : 5/8 d'un gÃ¢teau de 32 parts.</p>
                                <div class="exercice-interactif">
                                    <div class="calculation-area">
                                        <p>5/8 Ã— 32 = ?</p>
                                        <input type="number" id="calc-input" placeholder="Ta rÃ©ponse" style="padding: 8px; border: 2px solid #e2e8f0; border-radius: 8px; width: 100px; margin: 10px;">
                                        <button onclick="checkCalculation()" class="check-btn">VÃ©rifier</button>
                                        <div id="calc-feedback" class="exercise-feedback"></div>
                                        <div class="hint" style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                            ğŸ’¡ Astuce : (5 Ã— 32) Ã· 8
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mini Quiz -->
                        <div class="section">
                            <h3>ğŸ¯ Mini Quiz</h3>
                            <div class="quiz">
                                <p><strong>Question :</strong> Quelle fraction reprÃ©sente 2 parts sur 5 ?</p>
                                <div class="choix">
                                    <span onclick="checkAnswer(this, false)">2/3</span>
                                    <span onclick="checkAnswer(this, false)">5/2</span>
                                    <span onclick="checkAnswer(this, true)">2/5</span>
                                    <span onclick="checkAnswer(this, false)">1/2</span>
                                </div>
                                <div id="feedback" style="margin-top: 10px; font-weight: bold;"></div>
                            </div>
                        </div>
                        
                        <!-- DÃ©fi -->
                        <div class="section">
                            <h3>ğŸš€ DÃ©fi</h3>
                            <div class="defi">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <span>Tu as 30 secondes pour trouver 3 fractions Ã©quivalentes Ã  2/3.</span>
                                    <button onclick="startChallenge()" id="challengeBtn" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">Start â±ï¸</button>
                                </div>
                                <div id="challengeTimer" style="display: none; text-align: center; font-size: 1.2rem; font-weight: bold; color: #9f7aea;"></div>
                                <div id="challengeInput" style="display: none; margin-top: 12px;">
                                    <input type="text" placeholder="Ex: 4/6" style="padding: 8px; margin: 4px; border: 2px solid #e2e8f0; border-radius: 8px; width: 80px;">
                                    <input type="text" placeholder="Ex: 6/9" style="padding: 8px; margin: 4px; border: 2px solid #e2e8f0; border-radius: 8px; width: 80px;">
                                    <input type="text" placeholder="Ex: 8/12" style="padding: 8px; margin: 4px; border: 2px solid #e2e8f0; border-radius: 8px; width: 80px;">
                                </div>
                                <div id="challengeResult" style="margin-top: 12px; text-align: center; font-weight: bold;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 4: RÃ©flexion et MÃ©tacognition -->
        <div class="collapsible-section">
            <div class="collapsible-header" id="metacognitionHeader" onclick="toggleSection('metacognition')">
                <span>ğŸ¤” Phase 4: RÃ©flexion et MÃ©tacognition</span>
                <span class="collapsible-icon">ğŸ”½</span>
            </div>
            <div class="collapsible-content" id="metacognitionContent">
                <div class="collapsible-inner">
                    
                    <!-- Penses-tu avoir atteint l'objectif -->
                    <div class="section">
                        <h3>ğŸ¯ Penses-tu avoir atteint l'objectif</h3>
                        <div class="monitoring" id="monitoring-objectif">
                            <h4>ğŸ“‹ "Savoir lire, Ã©crire et reprÃ©senter une fraction"</h4>
                            <div class="monitoring-buttons">
                                <button class="monitoring-btn" onclick="rateSection('objectif', 4, this)">ğŸ‰ ComplÃ¨tement</button>
                                <button class="monitoring-btn" onclick="rateSection('objectif', 3, this)">ğŸ‘ En grande partie</button>
                                <button class="monitoring-btn" onclick="rateSection('objectif', 2, this)">ğŸ¤” Partiellement</button>
                                <button class="monitoring-btn" onclick="rateSection('objectif', 1, this)">ğŸ˜” Pas vraiment</button>
                            </div>
                            <div class="monitoring-feedback" id="feedback-objectif"></div>
                        </div>
                    </div>

                    <!-- Qu'est-ce qui t'a semblÃ© le plus facile -->
                    <div class="section">
                        <div class="metacognition-question">
                            <h4>ğŸ˜Š Qu'est-ce qui t'a semblÃ© le plus facile ?</h4>
                            <div class="metacognition-options">
                                <button class="meta-btn" onclick="selectMetaAnswer('facile', 'identifier', this)">ğŸ” Identifier le numÃ©rateur et le dÃ©nominateur</button>
                                <button class="meta-btn" onclick="selectMetaAnswer('facile', 'representer', this)">ğŸ¨ ReprÃ©senter une fraction sur un schÃ©ma</button>
                                <button class="meta-btn" onclick="selectMetaAnswer('facile', 'exercices', this)">ğŸ’ª Faire les exercices interactifs</button>
                                <button class="meta-btn" onclick="selectMetaAnswer('facile', 'comprendre', this)">ğŸ’¡ Comprendre le concept gÃ©nÃ©ral</button>
                            </div>
                            <div class="meta-feedback" id="feedback-facile"></div>
                        </div>
                    </div>

                    <!-- Quelle a Ã©tÃ© la plus grande difficultÃ© -->
                    <div class="section">
                        <div class="metacognition-question">
                            <h4>ğŸ˜… Quelle a Ã©tÃ© la plus grande difficultÃ© pour toi ?</h4>
                            <div class="metacognition-options">
                                <button class="meta-btn" onclick="selectMetaAnswer('difficile', 'confusion', this)">ğŸ”„ Confondre numÃ©rateur et dÃ©nominateur</button>
                                <button class="meta-btn" onclick="selectMetaAnswer('difficile', 'representation', this)">ğŸ¨ ReprÃ©senter visuellement les fractions</button>
                                <button class="meta-btn" onclick="selectMetaAnswer('difficile', 'equivalence', this)">âš–ï¸ Comprendre les fractions Ã©quivalentes</button>
                                <button class="meta-btn" onclick="selectMetaAnswer('difficile', 'aucune', this)">ğŸŒŸ Aucune difficultÃ© particuliÃ¨re</button>
                            </div>
                            <div class="meta-feedback" id="feedback-difficile"></div>
                        </div>
                    </div>

                    <!-- Comment utiliser dans la vie quotidienne -->
                    <div class="section">
                        <div class="metacognition-question">
                            <h4>ğŸŒŸ Comment pourrais-tu utiliser les fractions dans ta vie de tous les jours ?</h4>
                            <div class="metacognition-options">
                                <button class="meta-btn" onclick="selectMetaAnswer('utilite', 'cuisine', this)">ğŸ• Partager une pizza ou dÃ©couper un gÃ¢teau</button>
                                <button class="meta-btn" onclick="selectMetaAnswer('utilite', 'chocolat', this)">ğŸ« Partager une tablette de chocolat</button>
                                <button class="meta-btn" onclick="selectMetaAnswer('utilite', 'temps', this)">â° Comprendre les heures (1/2 heure, 1/4 d'heure)</button>
                                <button class="meta-btn" onclick="selectMetaAnswer('utilite', 'sport', this)">âš½ Compter les buts dans un match (2 buts sur 3 tentatives)</button>
                            </div>
                            <div class="meta-feedback" id="feedback-utilite"></div>
                        </div>
                    </div>
                    
                    <!-- DÃ©fi pratique personnalisÃ© -->
                    <div class="practical-challenge" id="practicalChallenge" style="display: none;">
                        <h4>ğŸ® DÃ©fi pratique personnalisÃ©</h4>
                        <div class="challenge-scenario" id="challengeScenario"></div>
                        <div class="challenge-input">
                            <input type="number" id="practicalAnswer" placeholder="Ta rÃ©ponse">
                            <button onclick="checkPracticalChallenge()">VÃ©rifier</button>
                        </div>
                        <div class="challenge-feedback" id="practicalFeedback"></div>
                    </div>
                    
                    <!-- Bouton pour finaliser -->
                    <div class="final-completion" id="finalCompletion" style="display: none;">
                        <button class="btn-primary celebration" onclick="completeMetacognition()">âœ¨ J'ai terminÃ© ma rÃ©flexion !</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales pour la prÃ©-Ã©valuation
        let preTestAnswers = {};
        let preTestScore = 0;
        let adaptedPath = 'beginner';
        let preTestCompleted = false;
        
        // Variables pour la progression
        let progressCount = 0;
        let totalActivities = 5;
        
        // Variables pour les sections collapsibles
        let completedSections = new Set();
        let currentPhase = 1;
        let totalScore = 0;
        
        // Variables pour les exercices
        let exercisesCompleted = {
            rectangle: false,
            droite: false,
            calcul: false
        };
        let metacognitionAnswers = {};
        let selectedParts = 0;
        let selectedMarker = null;
        
        // Variables pour le dÃ©fi
        let challengeTimer;
        let timeLeft = 30;
        
        // Fonctions pour gÃ©rer les sections collapsibles
        function toggleSection(sectionName) {
            const content = document.getElementById(sectionName + 'Content');
            const header = document.getElementById(sectionName + 'Header');
            const icon = header.querySelector('.collapsible-icon');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                header.classList.remove('expanded');
                icon.textContent = 'ğŸ”½';
            } else {
                content.classList.add('expanded');
                header.classList.add('expanded');
                icon.textContent = 'ğŸ”¼';
            }
        }
        
        function markSectionCompleted(sectionName) {
            completedSections.add(sectionName);
            const header = document.getElementById(sectionName + 'Header');
            if (header) {
                header.classList.add('completed');
            }
            updateProgressDisplay();
        }
        
        function updateProgressDisplay() {
            const phases = ['preEval', 'cours', 'exercices', 'metacognition'];
            const completedCount = completedSections.size;
            console.log(`Progression: ${completedCount}/4 phases complÃ©tÃ©es`);
        }
        
        // Gestion de la prÃ©-Ã©valuation
        function answerPreTest(questionNumber, correctness, button) {
            const questionDiv = button.parentElement;
            const allButtons = questionDiv.querySelectorAll('.test-option');
            
            allButtons.forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.7';
                btn.style.cursor = 'not-allowed';
            });
            
            if (correctness === 'correct') {
                button.classList.add('correct');
                preTestAnswers[questionNumber] = true;
            } else {
                button.classList.add('wrong');
                preTestAnswers[questionNumber] = false;
                allButtons.forEach(btn => {
                    if (btn.getAttribute('onclick').includes('correct')) {
                        btn.classList.add('correct');
                    }
                });
            }
            
            if (Object.keys(preTestAnswers).length === 3) {
                evaluatePreTest();
            }
        }
        
        function evaluatePreTest() {
            const correctAnswers = Object.values(preTestAnswers).filter(answer => answer).length;
            preTestScore = correctAnswers;
            
            const resultDiv = document.getElementById('preTestResult');
            const recommendationDiv = document.getElementById('recommendation');
            
            setTimeout(() => {
                if (correctAnswers >= 2) {
                    adaptedPath = 'advanced';
                    recommendationDiv.innerHTML = `
                        <div class="recommendation advanced">
                            ğŸŒŸ <strong>Super ! Tu as ${correctAnswers}/3 bonnes rÃ©ponses.</strong><br>
                            Tu as dÃ©jÃ  de bonnes bases. Passe aux exercices plus avancÃ©s pour te perfectionner.
                        </div>`;
                } else {
                    adaptedPath = 'beginner';
                    recommendationDiv.innerHTML = `
                        <div class="recommendation beginner">
                            ğŸ’ª <strong>Tu as ${correctAnswers}/3 bonnes rÃ©ponses.</strong><br>
                            Pas de panique ! C'est le bon moment pour revoir le cours. On reprend ensemble les bases.
                        </div>`;
                }
                
                resultDiv.style.display = 'block';
                resultDiv.scrollIntoView({ behavior: 'smooth' });
                preTestCompleted = true;
                markSectionCompleted('preEval');
            }, 1000);
        }
        
        function startAdaptedPath() {
            markSectionCompleted('preEval');
            toggleSection('preEval');
            
            if (adaptedPath === 'advanced') {
                toggleSection('exercices');
                setTimeout(() => {
                    document.getElementById('exercicesContent').scrollIntoView({ behavior: 'smooth' });
                }, 400);
            } else {
                toggleSection('cours');
                setTimeout(() => {
                    document.getElementById('coursContent').scrollIntoView({ behavior: 'smooth' });
                }, 400);
            }
        }
        
        // Gestion des exercices interactifs
        function togglePart(element) {
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                selectedParts--;
            } else {
                element.classList.add('selected');
                selectedParts++;
            }
        }
        
        function checkRectangle() {
            const feedback = document.getElementById('rect-feedback');
            const targetParts = 2; // 1/2 = 2 parts sur 4
            
            if (selectedParts === targetParts) {
                feedback.innerHTML = 'ğŸ‰ <strong>Bravo ! C\'est exactement Ã§a.</strong><br>Tu as bien compris comment reprÃ©senter une fraction : 1/2 = 2 parts coloriÃ©es sur 4 parts au total.';
                feedback.className = 'exercise-feedback feedback-success';
                exercisesCompleted.rectangle = true;
            } else {
                feedback.innerHTML = `âŒ <strong>Pas encore !</strong><br>Pour 1/2, il faut colorier 2 parts sur 4. Tu en as coloriÃ© ${selectedParts}.`;
                feedback.className = 'exercise-feedback feedback-error';
            }
        }
        
        function selectMarker(element, fraction) {
            if (selectedMarker) {
                selectedMarker.classList.remove('selected');
            }
            
            element.classList.add('selected');
            selectedMarker = element;
            
            const feedback = document.getElementById('line-feedback');
            
            if (fraction === '3/4') {
                feedback.innerHTML = 'ğŸ¯ <strong>Excellent ! Tu as visÃ© juste.</strong><br>3/4 (trois quarts) est effectivement Ã  cette position.';
                feedback.className = 'exercise-feedback feedback-success';
                exercisesCompleted.droite = true;
            } else {
                feedback.innerHTML = `âŒ <strong>Pas tout Ã  fait !</strong><br>Tu as sÃ©lectionnÃ© ${fraction}, mais on cherche 3/4.`;
                feedback.className = 'exercise-feedback feedback-error';
            }
        }
        
        function checkCalculation() {
            const input = document.getElementById('calc-input');
            const feedback = document.getElementById('calc-feedback');
            const answer = parseInt(input.value);
            const correct = 20; // 5/8 Ã— 32 = 20
            
            if (answer === correct) {
                feedback.innerHTML = 'ğŸ° <strong>Bravo ! C\'est exactement Ã§a.</strong><br>5/8 Ã— 32 = 20 parts de gÃ¢teau.';
                feedback.className = 'exercise-feedback feedback-success';
                exercisesCompleted.calcul = true;
            } else {
                feedback.innerHTML = `âŒ <strong>${answer || 'Aucune rÃ©ponse'} n'est pas correct.</strong><br>La bonne rÃ©ponse est 20. MÃ©thode : (5 Ã— 32) Ã· 8 = 20.`;
                feedback.className = 'exercise-feedback feedback-error';
            }
        }
        
        function checkAnswer(element, isCorrect) {
            const feedback = document.getElementById('feedback');
            const choices = document.querySelectorAll('.choix span');
            
            choices.forEach(choice => {
                choice.style.background = 'linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%)';
                choice.style.color = '#2d3748';
                choice.style.border = '2px solid transparent';
            });
            
            if (isCorrect) {
                element.style.background = 'linear-gradient(135deg, #68d391 0%, #38b2ac 100%)';
                element.style.color = 'white';
                element.style.border = '2px solid #22543d';
                feedback.innerHTML = 'ğŸ‰ <strong>Correct ! Excellent travail.</strong>';
                feedback.className = 'feedback-success';
            } else {
                element.style.background = 'linear-gradient(135deg, #fc8181 0%, #f56565 100%)';
                element.style.color = 'white';
                element.style.border = '2px solid #742a2a';
                feedback.innerHTML = 'âŒ <strong>Pas tout Ã  fait !</strong>';
                feedback.className = 'feedback-error';
                
                // Montrer la bonne rÃ©ponse
                choices.forEach(choice => {
                    if (choice.textContent.trim() === '2/5') {
                        choice.style.background = 'linear-gradient(135deg, #68d391 0%, #38b2ac 100%)';
                        choice.style.color = 'white';
                        choice.style.border = '2px solid #22543d';
                    }
                });
            }
        }
        
        // Fonctions de mÃ©tacognition
        function rateSection(section, rating, button) {
            const buttons = button.parentElement.querySelectorAll('.monitoring-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            
            const feedback = document.getElementById(`feedback-${section}`);
            const messages = {
                4: 'ğŸ‰ Fantastique ! Tu maÃ®trises parfaitement les fractions !',
                3: 'ğŸ‘ TrÃ¨s bien ! Tu as de bonnes bases sur les fractions.',
                2: 'ğŸ¤” C\'est un bon dÃ©but. Continue Ã  t\'entraÃ®ner !',
                1: 'ğŸ’ª Pas de panique ! Avec de l\'entraÃ®nement, tu vas y arriver !'
            };
            
            feedback.innerHTML = messages[rating];
            feedback.style.display = 'block';
        }
        
        function selectMetaAnswer(category, answer, button) {
            const buttons = button.parentElement.querySelectorAll('.meta-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            button.classList.add('selected');
            
            metacognitionAnswers[category] = answer;
            
            const feedback = document.getElementById(`feedback-${category}`);
            const responses = {
                facile: {
                    identifier: 'ğŸ” Super ! Identifier les Ã©lÃ©ments d\'une fraction est effectivement une base importante.',
                    representer: 'ğŸ¨ Excellent ! La reprÃ©sentation visuelle aide beaucoup Ã  comprendre.',
                    exercices: 'ğŸ’ª Bravo ! Les exercices interactifs rendent l\'apprentissage plus amusant.',
                    comprendre: 'ğŸ’¡ Parfait ! Comprendre le concept gÃ©nÃ©ral est fondamental.'
                },
                difficile: {
                    confusion: 'ğŸ”„ C\'est un piÃ¨ge classique ! Retiens : numÃ©rateur en haut, dÃ©nominateur en bas.',
                    representation: 'ğŸ¨ Normal ! Avec de l\'entraÃ®nement, tu vas y arriver.',
                    equivalence: 'âš–ï¸ C\'est un concept avancÃ©, pas d\'inquiÃ©tude !',
                    aucune: 'ğŸŒŸ Fantastique ! Tu as l\'air d\'avoir tout compris !'
                },
                utilite: {
                    cuisine: 'ğŸ• Exactement ! Les fractions sont trÃ¨s utiles en cuisine.',
                    chocolat: 'ğŸ« Miam ! C\'est un excellent exemple pratique.',
                    temps: 'â° TrÃ¨s pertinent ! Les fractions de temps sont partout.',
                    sport: 'âš½ Bonne observation ! Les statistiques utilisent souvent les fractions.'
                }
            };
            
            feedback.innerHTML = responses[category][answer] || 'Bonne rÃ©ponse !';
            feedback.style.display = 'block';
            
            // DÃ©clencher le dÃ©fi pratique aprÃ¨s avoir rÃ©pondu Ã  l'utilitÃ©
            if (category === 'utilite') {
                setTimeout(() => {
                    generatePracticalChallenge(answer);
                }, 1000);
            }
            
            // VÃ©rifier si toutes les questions sont rÃ©pondues
            if (Object.keys(metacognitionAnswers).length >= 3) {
                setTimeout(() => {
                    document.getElementById('finalCompletion').style.display = 'block';
                }, 2000);
            }
        }
        
        function generatePracticalChallenge(utilityType) {
            const challenge = document.getElementById('practicalChallenge');
            const scenario = document.getElementById('challengeScenario');
            
            const scenarios = {
                cuisine: {
                    text: 'ğŸ• Tu veux partager une pizza en 8 parts Ã©gales entre 3 amis. Combien de parts aura chaque ami ?',
                    answer: 2.67
                },
                chocolat: {
                    text: 'ğŸ« Tu as une tablette de 12 carrÃ©s de chocolat. Tu en manges 1/3. Combien de carrÃ©s as-tu mangÃ©s ?',
                    answer: 4
                },
                temps: {
                    text: 'â° Si un film dure 2 heures et que tu en as regardÃ© 3/4, combien de minutes as-tu regardÃ© ?',
                    answer: 90
                },
                sport: {
                    text: 'âš½ Dans un match, ton Ã©quipe a tirÃ© 15 fois au but et a marquÃ© 2/5 des tirs. Combien de buts avez-vous marquÃ©s ?',
                    answer: 6
                }
            };
            
            const selectedScenario = scenarios[utilityType];
            scenario.innerHTML = `<p>${selectedScenario.text}</p>`;
            challenge.style.display = 'block';
            challenge.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Fonction pour le dÃ©fi de fractions Ã©quivalentes
        function startChallenge() {
            const timer = document.getElementById('challengeTimer');
            const input = document.getElementById('challengeInput');
            const btn = document.getElementById('challengeBtn');
            const result = document.getElementById('challengeResult');
            
            // Reset
            btn.style.display = 'none';
            timer.style.display = 'block';
            input.style.display = 'block';
            result.innerHTML = '';
            timeLeft = 30;
            
            // Clear previous inputs
            const inputs = input.querySelectorAll('input');
            inputs.forEach(inp => {
                inp.value = '';
                inp.style.backgroundColor = '';
            });
            
            // Start timer
            challengeTimer = setInterval(() => {
                timeLeft--;
                timer.innerHTML = `â±ï¸ ${timeLeft} secondes`;
                
                if (timeLeft <= 10) {
                    timer.style.color = '#f56565';
                }
                
                if (timeLeft < 0) {
                    endChallenge();
                }
            }, 1000);
        }
        
        function endChallenge() {
            clearInterval(challengeTimer);
            const timer = document.getElementById('challengeTimer');
            const input = document.getElementById('challengeInput');
            const result = document.getElementById('challengeResult');
            const btn = document.getElementById('challengeBtn');
            
            timer.innerHTML = 'â° Temps Ã©coulÃ© !';
            
            const inputs = input.querySelectorAll('input');
            const answers = Array.from(inputs).map(inp => inp.value.trim());
            const validAnswers = ['4/6', '6/9', '8/12', '10/15', '12/18', '14/21'];
            
            let correct = 0;
            answers.forEach((answer, index) => {
                if (validAnswers.includes(answer)) {
                    inputs[index].style.backgroundColor = '#c6f6d5';
                    correct++;
                } else if (answer) {
                    inputs[index].style.backgroundColor = '#fed7d7';
                }
            });
            
            if (correct === 3) {
                result.innerHTML = 'ğŸ‰ Parfait ! Tu as trouvÃ© 3 fractions Ã©quivalentes !';
                result.style.color = '#22543d';
            } else if (correct > 0) {
                result.innerHTML = `ğŸ‘ Bien ! Tu en as trouvÃ© ${correct}/3. Exemples : 4/6, 6/9, 8/12`;
                result.style.color = '#744210';
            } else {
                result.innerHTML = 'ğŸ’ª Pas grave ! Exemples : 4/6, 6/9, 8/12 (multiplie haut et bas par 2, 3, 4...)';
                result.style.color = '#9f7aea';
            }
            
            setTimeout(() => {
                btn.style.display = 'inline-block';
                btn.innerHTML = 'Rejouer â±ï¸';
                timer.style.display = 'none';
            }, 3000);
        }
        
        function checkPracticalChallenge() {
            document.getElementById('practicalFeedback').innerHTML = 'ğŸ‰ Bien jouÃ© !';
        }
        
        function completeMetacognition() {
            alert('ğŸ‰ FÃ©licitations ! Tu as terminÃ© cette leÃ§on sur les fractions avec succÃ¨s !');
        }
        
        // Initialiser l'Ã©tat par dÃ©faut (prÃ©-Ã©valuation ouverte)
        window.addEventListener('load', function() {
            toggleSection('preEval');
            updateProgressDisplay();
        });
    </script>
</body>
</html>
