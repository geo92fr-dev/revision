<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">üéì Cours - FunRevis V2</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéì</text></svg>">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .breadcrumb {
            color: #666;
            margin-bottom: 1rem;
            font-size: 1rem;
            padding: 0.8rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .breadcrumb a {
            color: #007bff !important;
            text-decoration: underline !important;
            font-weight: 700 !important;
            transition: all 0.3s ease;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            background: #fff;
            border: 1px solid #007bff;
            margin: 0 0.2rem;
        }

        .breadcrumb a:hover {
            color: white !important;
            background-color: #007bff !important;
            text-decoration: none !important;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        /* Syst√®me de sections collapsibles */
        .sections-container {
            margin: 2rem 0;
        }

        .collapsible-section {
            margin-bottom: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .section-header:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4c93 100%);
        }

        .section-header.active {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4c93 100%);
        }

        .section-toggle {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
        }

        .section-header.active .section-toggle {
            transform: rotate(180deg);
        }

        .section-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }

        .section-content.active {
            padding: 2rem;
            max-height: none;
        }

        .section-inner {
            opacity: 0;
            transition: opacity 0.3s ease 0.1s;
        }

        .section-content.active .section-inner {
            opacity: 1;
        }

        /* Styles pour les exercices avec validation */
        .exercise-item {
            background: #f8f9ff;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border-left: 4px solid #667eea;
        }

        .exercise-question {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #2d3748;
        }

        .exercise-input {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .answer-input {
            padding: 0.8rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            min-width: 150px;
        }

        .answer-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .validate-btn {
            padding: 0.8rem 1.5rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .validate-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            font-weight: 600;
        }

        .feedback.correct {
            background: #d1fae5;
            color: #047857;
            border: 1px solid #34d399;
        }

        .feedback.incorrect {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #f87171;
        }

        /* Score et progression */
        .score-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            margin: 1rem 0;
        }

        .progress-bar {
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: #667eea;
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .loading {
            text-align: center;
            padding: 2rem;
        }

        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .success {
            background: #d1fae5;
            color: #047857;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .course-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border-left: 4px solid #667eea;
            background: #f8f9ff;
            border-radius: 0 8px 8px 0;
        }

        .navigation {
            margin-top: 2rem;
            text-align: center;
        }

        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            margin: 0 0.5rem;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        /* Styles pour les questions de m√©tacognition */
        .metacognition-question {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .metacognition-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .metacognition-option {
            padding: 0.8rem;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .metacognition-option:hover {
            background: #e2e8f0;
        }

        .metacognition-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Styles pour les ressources */
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .resource-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .resource-card h4 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .resource-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .resource-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="breadcrumb">
            <a href="../../index.html" id="breadcrumbHomeLink">üè† ACCUEIL</a> ‚Ä∫
            <a href="../mathematiques/index.html" id="breadcrumbSubjectLink">MATH√âMATIQUES</a> ‚Ä∫
            <a href="../mathematiques/index.html?level=6ieme" id="breadcrumbLevelLink">6√àME</a> ‚Ä∫
            <span id="breadcrumbTopic">Addition soustraction</span>
        </div>

        <h1 id="mainTitle">Addition et soustraction - 6√®me</h1>

        <div id="debugInfo" class="loading" style="display: none;">üîÑ Initialisation...</div>

        <!-- Syst√®me de sections collapsibles -->
        <div class="sections-container">
            <!-- Section Pr√©-√©valuation -->
            <div class="collapsible-section">
                <div class="section-header active" onclick="toggleSection('pre-evaluation')">
                    <span>üß™ Pr√©-√©valuation</span>
                    <span class="section-toggle">‚ñº</span>
                </div>
                <div class="section-content active" id="pre-evaluation">
                    <div class="section-inner">
                        <h3>üß™ Testez vos connaissances avant de commencer</h3>
                        <p>√âvaluez votre niveau actuel avec ces questions :</p>
                        <div id="preEvaluationContent"></div>
                        <div class="score-display" id="preEvaluationScore" style="display: none;">
                            <h4>üìä R√©sultat</h4>
                            <p id="preEvaluationScoreText"></p>
                            <div class="progress-bar">
                                <div class="progress-fill" id="preEvaluationProgress"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Cours -->
            <div class="collapsible-section">
                <div class="section-header" onclick="toggleSection('cours')">
                    <span>üìö Cours</span>
                    <span class="section-toggle">‚ñº</span>
                </div>
                <div class="section-content" id="cours">
                    <div class="section-inner">
                        <h3>üìö Contenu du cours</h3>
                        <div id="coursContent"></div>
                    </div>
                </div>
            </div>

            <!-- Section Exercices -->
            <div class="collapsible-section">
                <div class="section-header" onclick="toggleSection('exercices')">
                    <span>‚úèÔ∏è Exercices</span>
                    <span class="section-toggle">‚ñº</span>
                </div>
                <div class="section-content" id="exercices">
                    <div class="section-inner">
                        <h3>‚úèÔ∏è Exercices pratiques</h3>
                        <p>Pratiquez avec ces exercices interactifs :</p>
                        <div class="score-display" id="exercicesScore" style="display: none;">
                            <h4>üìä Score des exercices</h4>
                            <p id="exercicesScoreText"></p>
                            <div class="progress-bar">
                                <div class="progress-fill" id="exercicesProgress"></div>
                            </div>
                        </div>
                        <div id="exercicesContent"></div>
                    </div>
                </div>
            </div>

            <!-- Section Quiz -->
            <div class="collapsible-section">
                <div class="section-header" onclick="toggleSection('quiz')">
                    <span>üéØ Quiz</span>
                    <span class="section-toggle">‚ñº</span>
                </div>
                <div class="section-content" id="quiz">
                    <div class="section-inner">
                        <h3>üéØ Quiz d'√©valuation</h3>
                        <p>√âvaluez vos acquis avec ce quiz :</p>
                        <div id="quizContent">
                            <div class="course-section">
                                <p>Quiz avanc√© √† venir... Pour l'instant, utilisez les exercices interactifs dans la section Exercices.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section R√©flexion -->
            <div class="collapsible-section">
                <div class="section-header" onclick="toggleSection('reflexion')">
                    <span>ü§î R√©flexion</span>
                    <span class="section-toggle">‚ñº</span>
                </div>
                <div class="section-content" id="reflexion">
                    <div class="section-inner">
                        <h3>ü§î M√©tacognition</h3>
                        <p>R√©fl√©chissez sur votre apprentissage :</p>
                        <div id="reflexionContent"></div>
                    </div>
                </div>
            </div>

            <!-- Section Ressources -->
            <div class="collapsible-section">
                <div class="section-header" onclick="toggleSection('ressources')">
                    <span>üìñ Ressources</span>
                    <span class="section-toggle">‚ñº</span>
                </div>
                <div class="section-content" id="ressources">
                    <div class="section-inner">
                        <h3>üìñ Ressources compl√©mentaires</h3>
                        <p>Ressources suppl√©mentaires pour approfondir :</p>
                        <div id="ressourcesContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="navigation">
            <a href="javascript:history.back()" class="btn btn-secondary">‚Üê Retour</a>
            <a href="../../index.html" class="btn">üè† Accueil</a>
        </div>
    </div>

    <script>
        // Variables globales
        let courseData = null;
        let preEvaluationAnswers = {};
        let exerciseAnswers = {};
        let metacognitionAnswers = {};
        let preEvaluationScore = 0;
        let exerciseScore = 0;

        // Fonction principale de chargement
        async function loadCourse() {
            console.log('üöÄ Chargement du cours...');

            // R√©cup√©ration des param√®tres URL
            const urlParams = new URLSearchParams(window.location.search);
            const subject = urlParams.get('subject') || 'mathematiques';
            const level = urlParams.get('level') || '6ieme';
            const topic = urlParams.get('topic') || 'addition-soustraction';

            // Mise √† jour du breadcrumb
            updateBreadcrumb(subject, level, topic);

            // Mise √† jour du titre
            document.querySelector('h1').textContent = `${topic.replace('-', ' ')} - ${level}`;

            // Essayer de charger les vraies donn√©es
            try {
                console.log('üì° Tentative de chargement des donn√©es r√©elles...');
                await loadRealData(subject, level, topic);
            } catch (error) {
                console.log('‚ö†Ô∏è Utilisation du contenu de base', error);
                displayFallbackContent(subject, level, topic);
            }

            console.log('‚úÖ Cours charg√©');
        }

        // Fonction pour charger les vraies donn√©es
        async function loadRealData(subject, level, topic) {
            return new Promise((resolve, reject) => {
                const dataPath = `../data/${subject}/${level}/${topic}.js`;
                console.log('üìÅ Chargement de:', dataPath);

                const script = document.createElement('script');
                script.src = dataPath;

                script.onload = function() {
                    console.log('üì• Script charg√©, recherche des donn√©es...');

                    let data = null;
                    const possibleNames = [
                        topic + level.replace('ieme', '') + 'eme',
                        topic.replace('-', '') + level.replace('ieme', '') + 'eme',
                        'data',
                        'courseData',
                        topic.replace('-', ''),
                        topic
                    ];

                    for (const name of possibleNames) {
                        if (window[name]) {
                            data = window[name];
                            console.log('‚úÖ Donn√©es trouv√©es sous le nom:', name);
                            break;
                        }
                    }

                    if (data && data.competences && data.competences.length > 0) {
                        courseData = data;
                        populateContent(data.competences[0]);
                        resolve(data);
                    } else if (data) {
                        courseData = data;
                        populateContentAlternate(data);
                        resolve(data);
                    } else {
                        reject('Aucune donn√©e trouv√©e dans le script');
                    }
                };

                script.onerror = function() {
                    console.log('‚ùå Erreur de chargement du script:', dataPath);
                    reject('Erreur de chargement du script');
                };

                document.head.appendChild(script);
            });
        }

        // Fonction pour peupler le contenu avec les vraies donn√©es
        function populateContent(competence) {
            console.log('üîÑ Peuplement du contenu avec les donn√©es:', competence);

            // Pr√©-√©valuation
            if (competence.preEvaluation && competence.preEvaluation.length > 0) {
                populatePreEvaluation(competence.preEvaluation);
            }

            // Cours
            populateCours(competence);

            // Exercices
            if (competence.exercices && competence.exercices.length > 0) {
                populateExercices(competence.exercices);
            }

            // Quiz
            if (competence.quiz && competence.quiz.length > 0) {
                populateQuiz(competence.quiz);
            }

            // R√©flexion
            if (competence.metacognition && competence.metacognition.questions) {
                populateReflexion(competence.metacognition);
            }

            // Ressources
            if (competence.ressources && competence.ressources.length > 0) {
                populateRessources(competence.ressources);
            }
        }

        // Fonction alternative pour des structures de donn√©es diff√©rentes
        function populateContentAlternate(data) {
            console.log('üîÑ Peuplement avec structure alternative:', data);

            if (data.questions) {
                populateQuizFromQuestions(data.questions);
            }
        }

        function populatePreEvaluation(preEvaluation) {
            console.log('üìù Mise √† jour pr√©-√©valuation');
            const container = document.querySelector('#pre-evaluation .section-inner');
            let html = `
                <h3>üß™ Testez vos connaissances avant de commencer</h3>
                <p>√âvaluez votre niveau actuel avec ces questions :</p>
            `;

            preEvaluation.forEach((question, index) => {
                html += `
                    <div class="exercise-item">
                        <div class="exercise-question">${question.question}</div>
                        <div class="exercise-input">
                            <input type="text" class="answer-input" id="preeval-${index}" placeholder="Votre r√©ponse">
                            <button class="validate-btn" onclick="validatePreEvaluation(${index}, '${question.reponse}')">Valider</button>
                        </div>
                        <div class="feedback" id="preeval-feedback-${index}" style="display: none;"></div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function populateCours(competence) {
            console.log('üìö Mise √† jour cours');
            const container = document.querySelector('#cours .section-inner');
            let html = `<h3>üìö Contenu du cours</h3>`;

            if (competence.objectif) {
                html += `
                    <div class="course-section">
                        <h4>üéØ Objectif</h4>
                        <p>${competence.objectif}</p>
                    </div>
                `;
            }

            if (competence.cours) {
                html += `
                    <div class="course-section">
                        <h4>üìñ Contenu du cours</h4>
                        <div>${competence.cours}</div>
                    </div>
                `;
            }

            if (competence.lecon) {
                html += `
                    <div class="course-section">
                        <h4>üìñ Le√ßon</h4>
                        <div>${competence.lecon}</div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function populateExercices(exercices) {
            console.log('‚úèÔ∏è Mise √† jour exercices');
            const container = document.querySelector('#exercices .section-inner');
            let html = `
                <h3>‚úèÔ∏è Exercices pratiques</h3>
                <p>Pratiquez avec ces exercices interactifs :</p>
            `;

            exercices.forEach((exercice, index) => {
                const typeLabel = exercice.type ? exercice.type.toUpperCase() : 'EXERCICE';
                html += `
                    <div class="exercise-item">
                        <div class="exercise-question">
                            <span style="background: #667eea; color: white; padding: 0.3rem 0.8rem; border-radius: 12px; font-size: 0.8rem; margin-right: 0.5rem;">${typeLabel}</span>
                            ${exercice.question}
                        </div>
                        <div class="exercise-input">
                            <input type="text" class="answer-input" id="exercise-${index}" placeholder="Votre r√©ponse">
                            <button class="validate-btn" onclick="validateExercise(${index}, '${exercice.reponse}', ${exercice.points || 10})">Valider</button>
                        </div>
                        <div class="feedback" id="exercise-feedback-${index}" style="display: none;"></div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function populateQuiz(quiz) {
            console.log('‚ùì Mise √† jour quiz');
            const container = document.querySelector('#quiz .section-inner');
            let html = `
                <h3>‚ùì Quiz d'√©valuation</h3>
                <p>Testez vos connaissances avec ce quiz :</p>
            `;

            quiz.forEach((question, index) => {
                html += `
                    <div class="exercise-item">
                        <div class="exercise-question">${question.question}</div>
                        <div class="exercise-input">
                            <input type="text" class="answer-input" id="quiz-${index}" placeholder="Votre r√©ponse">
                            <button class="validate-btn" onclick="validateQuiz(${index}, '${question.reponse}', ${question.points || 10})">Valider</button>
                        </div>
                        <div class="feedback" id="quiz-feedback-${index}" style="display: none;"></div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function populateReflexion(metacognition) {
            console.log('ü§î Mise √† jour r√©flexion');
            const container = document.querySelector('#reflexion .section-inner');
            let html = `
                <h3>ü§î M√©tacognition</h3>
                <p>R√©fl√©chissez sur votre apprentissage :</p>
            `;

            metacognition.questions.forEach((question, index) => {
                html += `
                    <div class="course-section">
                        <h4>${question.question}</h4>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-top: 1rem;">
                `;

                question.options.forEach((option, optIndex) => {
                    html += `
                        <div style="padding: 0.8rem; background: #f7fafc; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;"
                             onclick="selectMetacognitionOption(${index}, ${optIndex}, '${option}', this)">
                            ${option}
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function populateRessources(ressources) {
            console.log('üìñ Mise √† jour ressources');
            const container = document.querySelector('#ressources .section-inner');
            let html = `
                <h3>üìñ Ressources compl√©mentaires</h3>
                <p>Ressources suppl√©mentaires pour approfondir :</p>
            `;

            ressources.forEach(ressource => {
                const emoji = ressource.type === 'vid√©o' ? 'üé¨' :
                            ressource.type === 'jeu' ? 'üéÆ' :
                            ressource.type === 'pdf' ? 'üìÑ' : 'üîó';

                html += `
                    <div class="course-section">
                        <h4>${emoji} ${ressource.titre}</h4>
                        <p>Type : ${ressource.type}</p>
                        <a href="${ressource.url}" target="_blank" style="color: #667eea; text-decoration: none; font-weight: 600;">
                            Acc√©der √† la ressource ‚Üí
                        </a>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Fonction pour basculer les sections
        function toggleSection(sectionId) {
            const sectionContent = document.getElementById(sectionId);
            const sectionHeader = sectionContent.previousElementSibling;

            const isActive = sectionContent.classList.contains('active');

            if (isActive) {
                sectionContent.classList.remove('active');
                sectionHeader.classList.remove('active');
            } else {
                sectionContent.classList.add('active');
                sectionHeader.classList.add('active');
            }
        }

        function updateBreadcrumb(subject, level, topic) {
            console.log('üîó Mise √† jour du breadcrumb:', subject, level, topic);

            const subjectLink = document.getElementById('breadcrumbSubjectLink');
            const levelLink = document.getElementById('breadcrumbLevelLink');
            const topicSpan = document.getElementById('breadcrumbTopic');

            if (subjectLink) {
                subjectLink.textContent = subject.charAt(0).toUpperCase() + subject.slice(1);
                subjectLink.href = `../${subject}/index.html`;
            }

            if (levelLink) {
                levelLink.textContent = level.toUpperCase();
                levelLink.href = `../${subject}/index.html?level=${level}`;
            }

            if (topicSpan) {
                topicSpan.textContent = topic.replace('-', ' ');
            }
        }

        // Fonctions de validation
        function validatePreEvaluation(questionIndex, correctAnswer) {
            const input = document.getElementById(`preeval-${questionIndex}`);
            const feedback = document.getElementById(`preeval-feedback-${questionIndex}`);
            const userAnswer = input.value.trim().toLowerCase();
            const correct = userAnswer === correctAnswer.toLowerCase();

            preEvaluationAnswers[questionIndex] = {
                userAnswer: input.value,
                correct: correct,
                correctAnswer: correctAnswer
            };

            showFeedback(feedback, correct, correctAnswer, input.value);
            updateProgress();
        }

        function validateExercise(questionIndex, correctAnswer, points = 10) {
            const input = document.getElementById(`exercise-${questionIndex}`);
            const feedback = document.getElementById(`exercise-feedback-${questionIndex}`);
            const userAnswer = input.value.trim().toLowerCase();
            const correct = userAnswer === correctAnswer.toLowerCase();

            exerciseAnswers[questionIndex] = {
                userAnswer: input.value,
                correct: correct,
                correctAnswer: correctAnswer,
                points: correct ? points : 0
            };

            showFeedback(feedback, correct, correctAnswer, input.value);
            updateProgress();
        }

        function validateQuiz(questionIndex, correctAnswer, points = 10) {
            const input = document.getElementById(`quiz-${questionIndex}`);
            const feedback = document.getElementById(`quiz-feedback-${questionIndex}`);
            const userAnswer = input.value.trim().toLowerCase();
            const correct = userAnswer === correctAnswer.toLowerCase();

            if (!window.quizAnswers) window.quizAnswers = {};

            window.quizAnswers[questionIndex] = {
                userAnswer: input.value,
                correct: correct,
                correctAnswer: correctAnswer,
                points: correct ? points : 0
            };

            showFeedback(feedback, correct, correctAnswer, input.value);
            updateProgress();
        }

        function showFeedback(feedbackElement, correct, correctAnswer, userAnswer) {
            feedbackElement.style.display = 'block';

            if (correct) {
                feedbackElement.innerHTML = `
                    <div style="color: #38a169; background: #f0fff4; padding: 1rem; border-radius: 8px; border-left: 4px solid #38a169;">
                        ‚úÖ <strong>Correct !</strong> Bravo !
                    </div>
                `;
            } else {
                feedbackElement.innerHTML = `
                    <div style="color: #e53e3e; background: #fff5f5; padding: 1rem; border-radius: 8px; border-left: 4px solid #e53e3e;">
                        ‚ùå <strong>Incorrect.</strong> La bonne r√©ponse est : <strong>${correctAnswer}</strong>
                        <br><small>Votre r√©ponse : ${userAnswer}</small>
                    </div>
                `;
            }
        }

        function selectMetacognitionOption(questionIndex, optionIndex, option, element) {
            const allOptions = element.parentElement.querySelectorAll('div');
            allOptions.forEach(opt => {
                opt.style.background = '#f7fafc';
                opt.style.borderColor = '#e2e8f0';
                opt.style.color = '#2d3748';
            });

            element.style.background = '#667eea';
            element.style.borderColor = '#667eea';
            element.style.color = 'white';

            metacognitionAnswers[questionIndex] = {
                questionIndex: questionIndex,
                optionIndex: optionIndex,
                option: option
            };
        }

        function updateProgress() {
            const preEvalTotal = Object.keys(preEvaluationAnswers).length;
            const preEvalCorrect = Object.values(preEvaluationAnswers).filter(a => a.correct).length;

            const exerciseTotal = Object.keys(exerciseAnswers).length;
            const exerciseCorrect = Object.values(exerciseAnswers).filter(a => a.correct).length;

            if (preEvalTotal > 0) {
                preEvaluationScore = Math.round((preEvalCorrect / preEvalTotal) * 100);
                const progressBar = document.getElementById('preEvaluationProgress');
                const scoreDisplay = document.getElementById('preEvaluationScore');
                const scoreText = document.getElementById('preEvaluationScoreText');

                if (progressBar) progressBar.style.width = `${preEvaluationScore}%`;
                if (scoreDisplay) scoreDisplay.style.display = 'block';
                if (scoreText) scoreText.textContent = `Score: ${preEvalCorrect}/${preEvalTotal} (${preEvaluationScore}%)`;
            }

            if (exerciseTotal > 0) {
                exerciseScore = Math.round((exerciseCorrect / exerciseTotal) * 100);
                const exerciseProgressBar = document.getElementById('exercicesProgress');
                const exerciseScoreDisplay = document.getElementById('exercicesScore');
                const exerciseScoreText = document.getElementById('exercicesScoreText');

                if (exerciseProgressBar) exerciseProgressBar.style.width = `${exerciseScore}%`;
                if (exerciseScoreDisplay) exerciseScoreDisplay.style.display = 'block';
                if (exerciseScoreText) exerciseScoreText.textContent = `Score: ${exerciseCorrect}/${exerciseTotal} (${exerciseScore}%)`;
            }
        }

        function displayFallbackContent(subject, level, topic) {
            const mainTitle = document.getElementById('mainTitle');
            mainTitle.textContent = `${topic.replace('-', ' ')} - ${level}`;

            // Pr√©-√©valuation par d√©faut
            document.getElementById('preEvaluationContent').innerHTML = `
                <div class="exercise-item">
                    <div class="exercise-question">Combien font 25 + 15 ?</div>
                    <div class="exercise-input">
                        <input type="text" class="answer-input" id="preeval-0" placeholder="Votre r√©ponse">
                        <button class="validate-btn" onclick="validatePreEvaluation(0, '40')">Valider</button>
                    </div>
                    <div class="feedback" id="preeval-feedback-0" style="display: none;"></div>
                </div>
                <div class="exercise-item">
                    <div class="exercise-question">Combien font 100 - 37 ?</div>
                    <div class="exercise-input">
                        <input type="text" class="answer-input" id="preeval-1" placeholder="Votre r√©ponse">
                        <button class="validate-btn" onclick="validatePreEvaluation(1, '63')">Valider</button>
                    </div>
                    <div class="feedback" id="preeval-feedback-1" style="display: none;"></div>
                </div>
            `;

            // Cours par d√©faut
            document.getElementById('coursContent').innerHTML = `
                <div class="course-section">
                    <h3>üéØ Objectif</h3>
                    <p>Ma√Ætriser l'addition et la soustraction des nombres entiers et d√©cimaux.</p>
                </div>
                <div class="course-section">
                    <h3>üìñ Contenu du cours</h3>
                    <p>L'addition et la soustraction sont les op√©rations de base en math√©matiques. Pour les nombres d√©cimaux, il faut bien aligner les virgules pour poser correctement l'op√©ration.</p>
                </div>
            `;

            // Exercices par d√©faut
            document.getElementById('exercicesContent').innerHTML = `
                <div class="exercise-item">
                    <div class="exercise-question">
                        <span style="background: #667eea; color: white; padding: 0.3rem 0.8rem; border-radius: 12px; font-size: 0.8rem; margin-right: 0.5rem;">D√âBUTANT</span>
                        Calcule 25 + 17
                    </div>
                    <div class="exercise-input">
                        <input type="text" class="answer-input" id="exercise-0" placeholder="Votre r√©ponse">
                        <button class="validate-btn" onclick="validateExercise(0, '42', 10)">Valider</button>
                    </div>
                    <div class="feedback" id="exercise-feedback-0" style="display: none;"></div>
                </div>
                <div class="exercise-item">
                    <div class="exercise-question">
                        <span style="background: #667eea; color: white; padding: 0.3rem 0.8rem; border-radius: 12px; font-size: 0.8rem; margin-right: 0.5rem;">INTERM√âDIAIRE</span>
                        Calcule 12,5 - 7,8
                    </div>
                    <div class="exercise-input">
                        <input type="text" class="answer-input" id="exercise-1" placeholder="Votre r√©ponse">
                        <button class="validate-btn" onclick="validateExercise(1, '4,7', 15)">Valider</button>
                    </div>
                    <div class="feedback" id="exercise-feedback-1" style="display: none;"></div>
                </div>
            `;

            // R√©flexion par d√©faut
            document.getElementById('reflexionContent').innerHTML = `
                <div class="metacognition-question">
                    <h4>Penses-tu avoir atteint l'objectif : 'Savoir additionner et soustraire des nombres entiers et d√©cimaux' ?</h4>
                    <div class="metacognition-options">
                        <div class="metacognition-option" onclick="selectMetacognitionOption(0, 0, 'üéâ Compl√®tement')">üéâ Compl√®tement</div>
                        <div class="metacognition-option" onclick="selectMetacognitionOption(0, 1, 'üëç En grande partie')">üëç En grande partie</div>
                        <div class="metacognition-option" onclick="selectMetacognitionOption(0, 2, 'ü§î Partiellement')">ü§î Partiellement</div>
                        <div class="metacognition-option" onclick="selectMetacognitionOption(0, 3, 'üòî Pas vraiment')">üòî Pas vraiment</div>
                    </div>
                </div>
            `;

            // Ressources par d√©faut
            document.getElementById('ressourcesContent').innerHTML = `
                <div class="resources-grid">
                    <div class="resource-card">
                        <h4>üé¨ Addition et soustraction</h4>
                        <p>Type : vid√©o</p>
                        <a href="https://www.youtube.com/watch?v=addition" target="_blank" class="resource-link">Acc√©der √† la ressource ‚Üí</a>
                    </div>
                    <div class="resource-card">
                        <h4>üéÆ Calcul mental</h4>
                        <p>Type : jeu</p>
                        <a href="https://www.logicieleducatif.fr/" target="_blank" class="resource-link">Acc√©der √† la ressource ‚Üí</a>
                    </div>
                </div>
            `;
        }

        // Lancement au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM charg√© - Chargement des sections');
            loadCourse();
        });

        // Initialisation automatique au chargement de la page
        window.addEventListener('load', function() {
            console.log('üåê Page enti√®rement charg√©e');
            loadCourse().catch(error => {
                console.error('‚ùå Erreur initialisation:', error);
            });
        });
    </script>
</body>
</html>
